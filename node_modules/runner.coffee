exec = require('child_process').exec
makeRequest = require('make_request')
dir = "./progs/"

runner = (id,compare,cases)->
  for key, value of cases
    do(key, value)->
      run_exe = exec dir+id,  (error, stdout, stderr) ->
        if error
          makeRequest({'stderr':stderr, 'eror':error},3000)
        else
          if compare
            result = if (stdout==value.output) then true else false
            makeRequest({'id':id,'case':key,'result':result},3000)
          else
            makeRequest({'id':id,'case':key,'result':stdout},3000)
      process.stdin.setMaxListeners(0)
      process.stdin.pipe(run_exe.stdin)
      run_exe.stdin.write(value.input)


module.exports = runner
